{% extends 'layout_login.html' %}

{% block stylesheet %}
{% endblock %}

{% block script %}
<script src="{{ url_for('static', filename='js/wavesurfer/wavesurfer.js') }}"></script>
<script src="{{ url_for('static', filename='js/wavesurfer/wavesurfer.timeline.js') }}"></script>
<script src="{{ url_for('static', filename='js/wavesurfer/wavesurfer.regions.js') }}"></script>
<script src="{{ url_for('static', filename='js/wavesurfer/wavesurfer.minimap.js') }}"></script>
<script type="text/javascript">
var probAudioPlayer;
$(document).ready(function(){
	$(document).on("click", ".waveRegionDiv .btn", function(){
		var regionIndex = $(this).attr("region");
		var region = Object.values(probAudioPlayer.regions.list)[regionIndex];
		region.play();
	});
	
	$(document).on("click", ".waveRegionDiv .del", function(){
		var regionIndex = $(this).attr("region");
		var region = Object.values(probAudioPlayer.regions.list)[regionIndex];
		region.remove();
	});

	probAudioPlayer = WaveSurfer.create({
		container: document.querySelector('#waveform'),
		waveColor: '#A8DBA8',
		progressColor: '#3B8686',
		backend: 'MediaElement',
		plugins: [
			WaveSurfer.regions.create({
				regionsMinLength: 2,
				regions: [
				],
				dragSelection: {
					slop: 5
				}
			})
		]
	});
	probAudioPlayer.load("{{ url_for('static', filename='audio/audio_sample.wav') }}");
	function regionUpdate(region, e){
		var region = Object.values(probAudioPlayer.regions.list);
		$(".waveRegionDiv ul").empty();
		for(var i=0; i<region.length; i++){
			var liEle = $("<li />");
			var spanEle = $("<span />");
			spanEle.addClass("btn").attr("region", i).text("구간 " + i + " : " + region[i].start.toFixed() + " ~ " + region[i].end.toFixed());
			var spanEle2 = $("<span />");
			spanEle2.addClass("del").attr("region", i).text("X");
			liEle.append(spanEle);
			liEle.append(spanEle2);
			$(".waveRegionDiv ul").append(liEle);
		}
	}
	probAudioPlayer.on('region-update-end', function(region, e){
		regionUpdate(region, e);
	});
	probAudioPlayer.on('region-removed', function(region, e){
		regionUpdate(region, e);
	});
});
</script>
{% endblock %}

{% block content %}
<div class="contentDiv">
	<h1>과제 추가</h1>
	<div class="probAddFormDiv">
		<div class="probAddFormLeftDiv">
			<div class="inputFormDiv">
				<div class="inputFormDiv-1">
					<label for class="probAddFormLabel">주차</label>
					<select class="inputStyle01" name="prob_week">
						<option value="1주차">1주차</option>
					</select>
				</div>
				<div class="inputFormDiv-2">
					<label for class="probAddFormLabel">기한</label>
					<input type="date" class="inputStyle01" name="prob_timeEnd">
				</div>
			</div>
			<div class="inputFormDiv">
				<div class="inputFormDiv-1 w75">
					<label for class="probAddFormLabel">과제명</label>
					<input type="text" class="inputStyle01" name="prob_name">
				</div>
				<div class="inputFormDiv-2 w25">
					<label for class="probAddFormLabel">과제 종류</label>
					<select class="inputStyle01" name="prob_type">
						<option value="순차통역">순차통역</option>
					</select>
				</div>
			</div>
			<div class="inputFormDiv">
				<label for class="probAddFormLabel">키워드</label>
				<input type="text" class="inputStyle01" name="prob_keyword">
			</div>
			<div class="inputFormDiv">
				<label for class="probAddFormLabel">과제 설명</label>
				<textarea class="inputStyle01" name="prob_exp"></textarea>
			</div>
			<div class="inputFormDiv">
				<div class="inputFormDiv-1 w25">
					<label for class="probAddFormLabel">다시 듣기 제한</label>
					<select class="inputStyle01" name="prob_replay">
						<option value="무제한">무제한</option>
					</select>
				</div>
				<div class="inputFormDiv-1 w25">
					<label for class="probAddFormLabel">재생 속도</label>
					<input type="text" class="inputStyle01" name="prob_play_speed">
				</div>
			</div>
			<div class="inputFormDiv">
				<input type="checkbox" name="prob_open">
				<label for class="probAddFormLabel">과제 제출물 공개 여부</label>
			</div>
		</div>
		<div class="probAddFormRightDiv">
			<div class="inputFormDiv">
				<label for class="probAddFormLabel">드래그하여 구간을 설정하세요.</label><br>
				<label for class="probAddFormLabel">원음 : ?분 ?초</label>
				<div id="waveform"></div>
				<div class="waveRegionDiv">
					<ul></ul>
				</div>
			</div>
		</div>
	</div>

</div>
{% endblock %}
