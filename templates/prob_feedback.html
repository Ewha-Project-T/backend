{% extends 'layout_login.html' %}

{% block stylesheet %}
		<link href="{{ url_for('static', filename='css/videojs/video-js.min.css') }}" rel="stylesheet">
		<link href="{{ url_for('static', filename='css/videojs/videojs.wavesurfer.min.css') }}" rel="stylesheet">
		<link href="{{ url_for('static', filename='css/videojs/videojs.record.min.css') }}" rel="stylesheet">
{% endblock %}

{% block script %}
		<script type="text/javascript" src="{{ url_for('static', filename='js/videojs/video.min.js') }}"></script>
		<script type="text/javascript" src="{{ url_for('static', filename='js/videojs/adapter.js') }}"></script>
		<script type="text/javascript" src="{{ url_for('static', filename='js/videojs/recorder.js') }}"></script>
		<script type="text/javascript" src="{{ url_for('static', filename='js/videojs/wavesurfer.min.js') }}"></script>
		<script type="text/javascript" src="{{ url_for('static', filename='js/videojs/wavesurfer.microphone.min.js') }}"></script>
		<script type="text/javascript" src="{{ url_for('static', filename='js/videojs/videojs.wavesurfer.min.js') }}"></script>
		<script type="text/javascript" src="{{ url_for('static', filename='js/videojs/videojs.record.min.js') }}"></script>
		<script type="text/javascript" src="{{ url_for('static', filename='js/videojs/videojs.record.recorderjs.min.js') }}"></script>
<script type="text/javascript">
var probFileList = []; // 문제파일
{% for i in wav_url_example %}
probFileList.push("{{ i.upload_url}}");
{% endfor %}
var submitFileList = []; // 녹음파일
{% for  i in wav_url %}
submitFileList.push("{{i.wav_url}}");
{% endfor %}
var probTextList = []; // 문제텍스트
{% for i in range(stt_result|length) %}
probTextList.push("{{original_stt_result[i].textFile}}"); 
//임시로 넣음
probFileList.push("original_stt_result[i].timestamps")
probFileList.push("original_stt_result[i].annotations")
{% endfor %}
var submitTextList = []; //녹음텍스트
{% for i in range(stt_result|length) %}
submitTextList.push("{{stt_result[i].textFile}}");
{% endfor %}
var audioOptions = {
	controls: true,
	autoplay: false,
	fluid: false,
	bigPlayButton: false,
	plugins: {
		wavesurfer: {
			backend: 'MediaElement',
			displayMilliseconds: false,
			debug: true,
			waveColor: '#086280',
			progressColor: 'black',
			cursorColor: 'black',
			hideScrollbar: true
		}
	}
};

function loadData(index){
	index = parseInt(index);
	examplePlayer.src({ src: probFileList[index], type: 'audio/wav'});
	submitPlayer.src({ src: submitFileList[index], type: 'audio/wav'});
	$(".exampleTextDiv div").empty().text(probTextList[index]);
	$(".assignmentTextDiv div").empty().text(submitTextList[index]);
}

var examplePlayer;
var submitPlayer;
$(document).ready(function(){
	// 플레이어 로딩
	examplePlayer = videojs("exampleAudioWaveSurfer", audioOptions, function(){ });
	submitPlayer = videojs("assignmentAudioWaveSurfer", audioOptions, function(){ });

	// 1번문제 로딩
	loadData(0);

	// 탭 클릭
	$(document).on("click", ".feedbackProbTab li", function(){
		loadData($(this).attr("idx"));
	});
});
</script>
{% endblock %}

{% block content %}
			<div class="contentDiv feedbackDiv">
				<div class="feedbackTitleDiv">
					<h1>{{as_name}} - {{user_info['user_name']}}</h1>
					<div class="btn-2">
						<button class="btn">동시재생</button>
						<button class="btn">저장</button>
					</div>
				</div>

				<ul class="feedbackProbTab">
					{% for i in wav_url_example %}
					<li idx="{{ loop.index - 1 }}">구간 {{ loop.index }}</li>
					{% endfor %}
				</ul>

				<div class="exampleAudioDiv">
					<audio id="exampleAudioWaveSurfer" class="video-js vjs-default-skin"></audio>
				</div>
				<div class="assignmentAudioDiv">
					<audio id="assignmentAudioWaveSurfer" class="video-js vjs-default-skin"></audio>
				</div>

				<div class="probTextDiv">
					<div class="probTextContentDiv">
						<div class="exampleTextDiv">
							<h2>원문</h2>
							<div></div>
						</div>
						<div class="assignmentTextDiv">
							<h2>통역 전사문</h2>
							<div></div>
						</div>
						<div class="commentTextDiv">
							<h2>총평</h2>
							<div>입력하는곳 </div>
						</div>
					</div>
					<div class="feedbackContentDiv">
						<div class="feedbackContentTitleDiv">
							<h2>피드백</h2>
							<!--button class="btn">불러오기</button-->
						</div>
						<ul>
							<li>
								<div class="feedbackContentRowDiv">
									<div class="feedbackContentRowTitleDiv">
									</div>
									<div class="feedbackContentRowContentDiv">
									</div>
								</div>
							</li>
							<li>
								<div class="feedbackContentRowDiv">
									<div class="feedbackContentRowTitleDiv">
									</div>
									<div class="feedbackContentRowContentDiv">
									</div>
								</div>
							</li>
							<li>
								<div class="feedbackContentRowDiv">
									<div class="feedbackContentRowTitleDiv">
									</div>
									<div class="feedbackContentRowContentDiv">
									</div>
								</div>
							</li>
						</ul>
					</div>
				</div>
			</div>
{% endblock %}
